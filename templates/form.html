<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Оформление посылки</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }
    .form-container {
      max-width: 700px;
      margin: 40px auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }
    .form-title {
      text-align: center;
      margin-bottom: 30px;
    }
    .form-control::placeholder {
      color: #bbb;
    }
  </style>
</head>
<body>

<div class="form-container">
  <h2 class="form-title">Оформление посылки</h2>

  <!-- Сообщения -->
  <div id="message-area">
        {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container mt-3">
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
        </div>
    {% endif %}
    {% endwith %}
  </div>

  <form id="parcel-form" enctype="multipart/form-data">
    <input type="hidden" name="token" value="{{ token }}">
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Имя отправителя</label>
        <input type="text" name="sender_first_name" class="form-control" placeholder="Введите имя" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Фамилия отправителя</label>
        <input type="text" name="sender_last_name" class="form-control" placeholder="Введите фамилию" required>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Телефон отправителя</label>
        <input type="tel" name="sender_phone" class="form-control" placeholder="+7..." required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Паспорт отправителя</label>
        <input type="text" name="sender_passport" class="form-control" placeholder="Серия и номер" required>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Имя получателя</label>
        <input type="text" name="recipient_first_name" class="form-control" placeholder="Введите имя" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Фамилия получателя</label>
        <input type="text" name="recipient_last_name" class="form-control" placeholder="Введите фамилию" required>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Телефон получателя</label>
        <input type="tel" name="recipient_phone" class="form-control" placeholder="+995..." required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Паспорт получателя</label>
        <input type="text" name="recipient_passport" class="form-control" placeholder="Серия и номер" required>
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Город получения</label>
      <select class="form-control" name="city" id="city" required>
        <option value="TBILISI">TBILISI</option>
        <option value="BATUMI">BATUMI</option>
        <option value="KOBULETI">KOBULETI</option>
        <option value="KUTAISI">KUTAISI</option>
        <option value="TELAVI">TELAVI</option>
        <option value="GORI">GORI</option>
        <option value="ZUGDIDI">ZUGDIDI</option>
        <option value="POTI">POTI</option>
        <option value="KHASHURI">KHASHURI</option>
        <option value="RUSTAVI">RUSTAVI</option>
        <option value="SAMTREDIA">SAMTREDIA</option>
        <option value="SENAKI">SENAKI</option>
        <option value="ZESTAPHONI">ZESTAPHONI</option>
        <option value="MARNEULI">MARNEULI</option>
        <option value="AKHALTSIKHE">AKHALTSIKHE</option>
        <option value="OZURGETI">OZURGETI</option>
        <option value="KASPI">KASPI</option>
        <option value="TCHIATURA">TCHIATURA</option>
        <option value="TSKALTUBO">TSKALTUBO</option>
        <option value="SAGAREJO">SAGAREJO</option>
        <option value="GARDABANI">GARDABANI</option>
        <option value="BORJOMI">BORJOMI</option>
        <option value="TKIBULI">TKIBULI</option>
        <option value="KHONI">KHONI</option>
        <option value="BOLNISI">BOLNISI</option>
        <option value="AKHALKALAKI">AKHALKALAKI</option>
        <option value="GURJAANI">GURJAANI</option>
        <option value="MTSKHETA">MTSKHETA</option>
        <option value="KVARELI">KVARELI</option>
        <option value="AKHMETA">AKHMETA</option>
        <option value="KARELI">KARELI</option>
        <option value="LANCHKHUTA">LANCHKHUTA</option>
        <option value="DUSHETI">DUSHETI</option>
        <option value="SACHKHERE">SACHKHERE</option>
        <option value="DEDOPLISTSKARO">DEDOPLISTSKARO</option>
        <option value="LAGODEKHI">LAGODEKHI</option>
        <option value="NINOTSMINDA">NINOTSMINDA</option>
        <option value="ABASHA">ABASHA</option>
        <option value="TSNORI">TSNORI</option>
        <option value="TERJOBA">TERJOBA</option>
        <option value="MARTVILI">MARTVILI</option>
        <option value="KHOBI">KHOBI</option>
        <option value="TSALENJIKHA">TSALENJIKHA</option>
        <option value="VANI">VANI</option>
        <option value="BAGDADI">BAGDADI</option>
        <option value="VALE">VALE</option>
        <option value="CHKHOROTSKU">CHKHOROTSKU</option>
        <option value="TETRITSQARO">TETRITSQARO</option>
        <option value="DMANISI">DMANISI</option>
        <option value="ONI">ONI</option>
        <option value="TSALKA">TSALKA</option>
        <option value="AMBROLAURI">AMBROLAURI</option>
        <option value="SIGNAGI">SIGNAGI</option>
        <option value="TSAGERI">TSAGERI</option>
        <option value="JVARI">JVARI</option>
    </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Описание посылки</label>
      <textarea name="description" rows="3" class="form-control" placeholder="Что внутри? Укажите важные детали..." required></textarea>
    </div>
    <div class="mb-4">
      <label class="form-label">Загрузить накладную (PDF)</label>
      <input type="file" name="invoice" accept="application/pdf" class="form-control">
    </div>
    <div class="d-grid">
      <button type="submit" class="btn btn-primary btn-lg">Отправить заявку</button>
    </div>
  </form>
</div>

<script>
document.getElementById('parcel-form').addEventListener('submit', function(e) {
  e.preventDefault(); // Не даём форме перезагрузить страницу

  const form = e.target;
  const formData = new FormData(form);

  fetch('/submit-parcel', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    // Очищаем старые сообщения
    const messageArea = document.getElementById('message-area');
    messageArea.innerHTML = '';

    if (data.status && data.message) {
      const alert = document.createElement('div');
      alert.className = `alert alert-${data.status} alert-dismissible fade show mt-3`;
      alert.setAttribute('role', 'alert');
      alert.innerHTML = `
        ${data.message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      `;
      messageArea.appendChild(alert);
    }

    // Если успех, отключаем элементы формы
    if (data.status === 'success') {
      form.querySelectorAll('input, textarea, select, button').forEach(el => {
        el.disabled = true; // Блокируем все элементы формы
      });
    }
  })
  .catch(err => {
    console.error('Ошибка:', err);
  });
});
</script>

</body>
</html>
