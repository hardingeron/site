 {% extends 'base.html' %}
    
    {% block title %}
    {{ super() }}
    ·Éë·Éö·Éê·Éú·Éô·Éî·Éë·Éò
    {% endblock %}
    
    {% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/shipments.css') }}">

<body>
    <div id="toast-container"></div>
    
    <!--  –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç–∞—Ä–Ω–∏—Ü–µ -->
    <div class="page-actions">
        <div class="action-card add" id="addParcelCard">
            <div class="icon">‚ûï</div>
            <div class="text">
                <div class="title">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</div>
                <div class="desc">–ù–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</div>
            </div>
        </div>
        
        <div class="action-card export" id="downloadExcelBtn">
            <div class="icon">‚¨áÔ∏è</div>
            <div class="text">
                <div class="title">–í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
                <div class="desc">Excel</div>
            </div>
        </div>
        
        <div class="action-card stats">
            <div class="icon">üìä</div>
            <div class="text">
                <div class="title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="desc">–î–æ—Ö–æ–¥—ã –∏ –ø–æ—Å—ã–ª–∫–∏</div>
            </div>
        </div>
    </div>
    
    
    
    <!--  –≥–ª–∞–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç–∞—Ä–Ω–∏—Ü–µ -->
    <style>
        .parcel-card.sequence-0 { background-color: #ffffff; }
        .parcel-card.sequence-1 { background-color: #dddddd; }
    </style>
<!-- –í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ -->

<div class="shipments">
    
    <div class="select-all-container">
        <label class="select-all-checkbox">
            <input type="checkbox" id="selectAllShipments">
            <span>–í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ –ø–æ—Å—ã–ª–∫–∏</span>
        </label>
        
        <div class="selected-summary">
            <div class="label">–í—ã–±—Ä–∞–Ω–æ:</div>
            <div class="value" id="selectedInfo">0 —à—Ç / 0 –∫–≥</div>
        </div>
        
    </div>
    
    {% for shipment in shipments %}
    <div class="parcel-card
    {% if shipment.payment_status == 'paid' or shipment.payment_status == 'card' %}payment-paid
    {% elif shipment.payment_status == 'unpaid' %}payment-unpaid
    {% endif %}
    {% if shipment.sequence == 1 %} sequence-1{% elif shipment.sequence == 0 %} sequence-0{% endif %}">
    
    
    <div class="parcel-main">
        <!-- –ß–µ–∫–±–æ–∫—Å -->
        
        <!-- ‚Ññ –ø–æ—Å—ã–ª–∫–∏ -->
        <div>
            <label class="parcel-checkbox">
                <input type="checkbox" 
                name="selected_shipments" 
                value="{{ shipment.id }}"
                data-parcels="{{ shipment.parcels_count }}"
                data-weight="{{ shipment.total_weight }}">
                <span></span>
            </label>
            
            <div class="label">‚Ññ –ø–æ—Å—ã–ª–∫–∏</div>
            <div class="value">
                TRK-{{ shipment.shipment_number}}
            </div>
            <div class="label">{{ shipment.order_date.strftime('%d.%m.%Y %H:%M') if shipment.order_date else '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</div>
        </div>
        
        
        <!-- –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å -->
        <div>
            <div class="label">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</div>
            <div class="value">
                {{ shipment.sender_name }} {{ shipment.sender_surname }}
            </div>
            <div class="phone">
                {{ shipment.sender_number }}
            </div>
        </div>
        
        <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å -->
        <div>
            <div class="label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</div>
            <div class="receiver-name">
                <div class="value">
                    {{ shipment.recipient_name }} {{ shipment.recipient_surname }}
                </div>
                <button class="copy-btn" onclick="copyName(this)">üìã</button>
            </div>
            <div class="phone">
                {{ shipment.recipient_number }}
            </div>
        </div>
        
        <!-- –ö–æ–ª-–≤–æ / –≤–µ—Å -->
        <div>
            <div class="label">–ö–æ–ª-–≤–æ / –≤–µ—Å</div>
            <div class="value">
                {{ shipment.parcels_count }} —à—Ç / {{shipment.total_weight}}
            </div>
        </div>
        
        <!-- –ì–æ—Ä–æ–¥ -->
        <div>
            <div class="label">–ì–æ—Ä–æ–¥</div>
            <div class="value">
                {{ shipment.city_to }}
            </div>
        </div>
        
        <button class="toggle-btn">‚åÑ</button>
        
    </div>
    
    <!-- üîΩ –î–µ—Ç–∞–ª–∏ -->
<div class="parcel-details mt-3">

    <!-- 1. –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="mb-3">
        <div class="fw-semibold text-muted mb-1">üì¶ –û–ø–∏—Å—å</div>
        <div>{{ shipment.description }}</div>
    </div>

    <div class="mb-3">
        <div class="fw-semibold text-muted mb-1">üè¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ñ–∏—Å–∞</div>
        <div>{{ shipment.information_for_office }}</div>
    </div>

    <hr>

    <!-- 2. –û–ø–ª–∞—Ç–∞ / –°—Ç–æ–∏–º–æ—Å—Ç—å / –ü–∞—Å–ø–æ—Ä—Ç -->
    <div class="row g-2 mb-3 align-items-start">

        <!-- –û–ø–ª–∞—Ç–∞ -->
        <div class="col-md-4">
            <div class="fw-semibold text-muted mb-1">üí≥ –û–ø–ª–∞—Ç–∞</div>
            {% if shipment.payment_status == 'paid' %}
                <span class="badge bg-success">–û–ø–ª–∞—á–µ–Ω–æ</span>
            {% else %}
                <span class="badge bg-danger">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>
            {% endif %}
            <span class="badge bg-light text-dark">
                {{ shipment.payment_amount }} {{ shipment.currency }}
            </span>
        </div>

        <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å -->
        <div class="col-md-4">
            <div class="fw-semibold text-muted mb-1">üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å</div>
            <span class="badge bg-primary">
                {{ shipment.cargo_cost }} RUB
            </span>
        </div>

        <!-- –ü–∞—Å–ø–æ—Ä—Ç -->
        <div class="col-md-4">
            <div class="fw-semibold text-muted mb-1">ü™™ –ü–∞—Å–ø–æ—Ä—Ç</div>
            <span class="badge bg-light text-dark">
                {{ shipment.recipient_passport }}
            </span>
        </div>

    </div>
    <hr>

    <!-- 3. –í–µ—Å –∏ –∞–¥—Ä–µ—Å -->
    <div class="row g-2 mb-3 align-items-start">

        <!-- –í–µ—Å -->
        <div class="col-md-4">
            <div class="fw-semibold text-muted mb-1">‚öñÔ∏è –í–µ—Å</div>
            {% for weight in shipment.weights.split() %}
                <span class="badge bg-secondary rounded-pill">
                    {{ weight }} –∫–≥
                </span>
            {% endfor %}
        </div>

        <!-- –ê–¥—Ä–µ—Å -->
        <div class="col-md-8">
            <div class="fw-semibold text-muted mb-1">üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
            <div>{{ shipment.address }}</div>
        </div>

    </div>

    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="text-end">
        <button class="btn btn-sm btn-outline-primary edit-btn" data-id="{{ shipment.id }}">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
    </div>

</div>
    
</div>
{% else %}
<div class="empty-state">
    –ü–æ—Å—ã–ª–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
</div>
{% endfor %}

</div>


</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div class="modal-overlay" id="parcelModal">
    <div class="shipment-modal">
        
        <!-- –®–∞–≥–∏ -->
        <div class="modal-steps">
            <div class="steps">
                
                <div class="step active" data-step="0">
                    <div>üë§</div>
                    <div class="label">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</div>
                </div>
                
                <div class="step" data-step="1">
                    <div>üì¶</div>
                    <div class="label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</div>
                </div>
                
                <div class="step" data-step="2">
                    <div>‚öñÔ∏è</div>
                    <div class="label">–ü–æ—Å—ã–ª–∫–∞</div>
                </div>
                
                <div class="step" data-step="3">
                    <div>üìù</div>
                    <div class="label">–û–ø–∏—Å—å</div>
                </div>
                
                <div class="step" data-step="4">
                    <div>üí≥</div>
                    <div class="label">–û–ø–ª–∞—Ç–∞</div>
                </div>
                
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="modal-content">
            
            <div class="step-content active">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ</h3>
                <div class="sender-form">
                    
                    <div class="input-group">
                        <label>–ò–º—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" id="senderName">
                    </div>
                    
                    <div class="input-group">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" id="senderSurname">
                    </div>
                    
                    <div class="input-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" placeholder="+7 XXX XX XX XXX" id="senderPhone">
                    </div>
                    
                </div>
                
            </div>
            
            <div class="step-content">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ</h3>
                <div class="recipient-form">
                    
                    <div class="input-group">
                        <label>–ò–º—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" id="recipientName">
                    </div>
                    
                    <div class="input-group">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" id="recipientSurname">
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" placeholder="5XX XX XX XX" id="recipientPhone">
                        </div>
                        
                        <div class="input-group">
                            <label>–ü–∞—Å–ø–æ—Ä—Ç</label>
                            <input type="text" placeholder="* * * * *" id="recipientPassport">
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="step-content">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å—ã–ª–∫–µ</h3>
                <div class="parcel-form">
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>–í–µ—Å</label>
                            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏–ª–∏ –≤–µ—Å–∞" id="parcelWeight">
                            <input type="hidden" name="weights" id="weightsHidden">
                        </div>
                        <!-- –ì–æ—Ä–æ–¥ (—Å–ø–∏—Å–æ–∫) -->
                        <div class="input-group">
                            <label>–ì–æ—Ä–æ–¥ –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                            <select id="parcelCity">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                <option value="TBILISI">TBILISI</option>
                                <option value="BATUMI">BATUMI</option>
                                <option value="KOBULETI">KOBULETI</option>
                                <option value="KUTAISI">KUTAISI</option>
                                <option value="TELAVI">TELAVI</option>
                                <option value="GORI">GORI</option>
                                <option value="ZUGDIDI">ZUGDIDI</option>
                                <option value="POTI">POTI</option>
                                <option value="KHASHURI">KHASHURI</option>
                                <option value="RUSTAVI">RUSTAVI</option>
                                <option value="SAMTREDIA">SAMTREDIA</option>
                                <option value="SENAKI">SENAKI</option>
                                <option value="ZESTAPHONI">ZESTAPHONI</option>
                                <option value="MARNEULI">MARNEULI</option>
                                <option value="AKHALTSIKHE">AKHALTSIKHE</option>
                                <option value="OZURGETI">OZURGETI</option>
                                <option value="KASPI">KASPI</option>
                                <option value="TCHIATURA">TCHIATURA</option>
                                <option value="TSKALTUBO">TSKALTUBO</option>
                                <option value="SAGAREJO">SAGAREJO</option>
                                <option value="GARDABANI">GARDABANI</option>
                                <option value="BORJOMI">BORJOMI</option>
                                <option value="TKIBULI">TKIBULI</option>
                                <option value="KHONI">KHONI</option>
                                <option value="BOLNISI">BOLNISI</option>
                                <option value="AKHALKALAKI">AKHALKALAKI</option>
                                <option value="GURJAANI">GURJAANI</option>
                                <option value="MTSKHETA">MTSKHETA</option>
                                <option value="KVARELI">KVARELI</option>
                                <option value="AKHMETA">AKHMETA</option>
                                <option value="KARELI">KARELI</option>
                                <option value="LANCHKHUTA">LANCHKHUTA</option>
                                <option value="DUSHETI">DUSHETI</option>
                                <option value="SACHKHERE">SACHKHERE</option>
                                <option value="DEDOPLISTSKARO">DEDOPLISTSKARO</option>
                                <option value="LAGODEKHI">LAGODEKHI</option>
                                <option value="NINOTSMINDA">NINOTSMINDA</option>
                                <option value="ABASHA">ABASHA</option>
                                <option value="TSNORI">TSNORI</option>
                                <option value="TERJOBA">TERJOBA</option>
                                <option value="MARTVILI">MARTVILI</option>
                                <option value="KHOBI">KHOBI</option>
                                <option value="TSALENJIKHA">TSALENJIKHA</option>
                                <option value="VANI">VANI</option>
                                <option value="BAGDADI">BAGDADI</option>
                                <option value="VALE">VALE</option>
                                <option value="CHKHOROTSKU">CHKHOROTSKU</option>
                                <option value="TETRITSQARO">TETRITSQARO</option>
                                <option value="DMANISI">DMANISI</option>
                                <option value="ONI">ONI</option>
                                <option value="TSALKA">TSALKA</option>
                                <option value="AMBROLAURI">AMBROLAURI</option>
                                <option value="SIGNAGI">SIGNAGI</option>
                                <option value="TSAGERI">TSAGERI</option>
                                <option value="JVARI">JVARI</option>
                            </select>
                        </div>
                    </div>
                    <div id="weightContainer" class="weight-container"></div>
                    
                    
                    <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∫ –æ–ø–ª–∞—Ç–µ -->
                    <div class="row">
                        <div class="input-group">
                            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –≥—Ä—É–∑–∞</label>
                            <input type="number" placeholder="0.00" id="parcelCost">
                        </div>
                    </div>
                    
                    <!-- –ê–¥—Ä–µ—Å -->
                    <div class="input-group">
                        <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <input type="text" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞" id="parcelAddress">
                    </div>
                </div>
            </div>
            
            <div class="step-content">
                <h3>–û–ø–∏—Å—å</h3>
                <div class="parcel-form">
                    <!-- –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ -->
                    <label>–°–ø–∏—Å–æ–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ</label>
                    <div class="modern-textarea-wrapper">
                        <div id="inventoryContainer" class="inventory-container"></div>
                        <input 
                        id="inventoryInput" 
                        type="text" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..." 
                        autocomplete="off"
                        data-inventory='{{ inventory|tojson }}'>
                        <ul id="autocompleteList" class="autocomplete-list" style="display: none;"></ul>
                    </div>
                    <div class="input-group">
                        <label>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ñ–∏—Å–∞</label>
                        <input type="text" id="informationForOffice" autocomplete="off">
                    </div>
                </div>
            </div>
            
            <div class="step-content">
                <h3>–û–ø–ª–∞—Ç–∞</h3>
                <div class="parcel-form">
                    <div id="paymentBlock">
                        <div class="input-group">
                            <label>–ö –æ–ø–ª–∞—Ç–µ</label>
                            <input type="number" placeholder="0.00" id="paymentAmount">
                        </div>
                        
                        <div class="radio-group">
                            <span class="group-title">–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã</span>
                            
                            <label class="radio">
                                <input type="radio" name="payment" id="paid">
                                <span>–û–ø–ª–∞—á–µ–Ω–æ</span>
                            </label>
                            
                            <label class="radio">
                                <input type="radio" name="payment" id="unpaid">
                                <span>–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>
                            </label>
                            
                            <label class="radio">
                                <input type="radio" name="payment" id="card">
                                <span>–° –∫–∞—Ä—Ç—ã</span>
                            </label>
                        </div>
                        
                        <div class="radio-group">
                            <span class="group-title">–í–∞–ª—é—Ç–∞</span>
                            
                            <label class="radio">
                                <input type="radio" name="currency" id="GEL">
                                <span>üá¨üá™ ‚Çæ GEL</span>
                            </label>
                            
                            <label class="radio">
                                <input type="radio" name="currency" id="RUB">
                                <span>üá∑üá∫ ‚ÇΩ RUB</span>
                            </label>
                            
                            <label class="radio">
                                <input type="radio" name="currency" id="EUR">
                                <span>üá™üá∫ ‚Ç¨ EUR</span>
                            </label>
                            
                            <label class="radio">
                                <input type="radio" name="currency" id="USD">
                                <span>üá∫üá∏ $ USD</span>
                            </label>
                        </div>
                    </div>
                    
                    
                    <div class="checkbox-group">
                        <label class="checkbox">
                            <input type="checkbox" id="sharedRecipient">
                            <span>–¢–æ—Ç –∂–µ –∫–ª–∏–µ–Ω—Ç</span>
                        </label>
                    </div>
                </div>
                
            </div>
            
            
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="modal-actions">
            <button id="closeModalBtn" style="background-color: rgb(255, 97, 97)">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button id="prevBtn" disabled>–ù–∞–∑–∞–¥</button>
            <button id="nextBtn">–î–∞–ª–µ–µ</button>
            <button id="finishBtn" class="hidden">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
        
    </div>
</div>







<script>
    document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const card = btn.closest('.parcel-card');
            const details = card.querySelector('.parcel-details');
            
            const open = details.style.display === 'block';
            details.style.display = open ? 'none' : 'block';
            btn.style.transform = open ? 'rotate(0)' : 'rotate(180deg)';
        });
    });
    
    function copyName(btn) {
    const name = btn.parentElement.querySelector('.value').innerText;
    navigator.clipboard.writeText(name);

    btn.innerText = '‚úì';
    setTimeout(() => btn.innerText = 'üìã', 1000);
}
</script>





<script>
function goToStep(stepIndex) {
    currentStep = stepIndex;
    updateUI();
}
</script>


<script>
let currentStep = 0;

const steps = document.querySelectorAll('.step');
const contents = document.querySelectorAll('.step-content');

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const finishBtn = document.getElementById('finishBtn');

/* =========================
   –†–∞–±–æ—Ç–∞ —Å –æ—à–∏–±–∫–∞–º–∏ (LABEL)
========================= */

function clearErrors(stepContent) {
    stepContent.querySelectorAll('.label-error').forEach(label => {
        label.classList.remove('label-error');
    });
}

function markError(target) {
    if (!target) return;

    // üîπ INPUT –∏–ª–∏ TEXTAREA ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ placeholder
    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {
        target.classList.add('placeholder-error');

        setTimeout(() => {
            target.classList.remove('placeholder-error');
        }, 2000);
    } 
    // üîπ SELECT ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ option
    else if (target.tagName === 'SELECT') {
        target.classList.add('select-error');

        setTimeout(() => {
            target.classList.remove('select-error');
        }, 2000);
    }
    // üîπ inventoryContainer ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ placeholder —É input –≤–Ω—É—Ç—Ä–∏
    else if (target.id === 'inventoryContainer') {
        const input = target.closest('.modern-textarea-wrapper')?.querySelector('#inventoryInput');
        if (!input) return;

        input.classList.add('placeholder-error');

        setTimeout(() => {
            input.classList.remove('placeholder-error');
        }, 2000);
    } 
    // üîπ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º label
    else {
        const label = target.querySelector('label');
        if (!label) return;

        const originalColor = label.style.color || getComputedStyle(label).color;
        label.style.color = '#ef4444';

        setTimeout(() => {
            label.style.color = originalColor;
        }, 2000);
    }
}

/* =========================
   –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–≥–æ–≤
========================= */

function validateStep(stepIndex) {
    const step = contents[stepIndex];
    clearErrors(step);

    let valid = true;

    // üîπ –®–∞–≥ 0 ‚Äî –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
    if (stepIndex === 0) {
        ["senderName", "senderSurname", "senderPhone"].forEach(id => {
            const input = document.getElementById(id);
            if (!input || !input.value.trim()) {
                markError(input);
                valid = false;
            }
        });
    }

    // üîπ –®–∞–≥ 1 ‚Äî –ü–æ–ª—É—á–∞—Ç–µ–ª—å
    if (stepIndex === 1) {
        ["recipientName", "recipientSurname", "recipientPhone", "recipientPassport"].forEach(id => {
            const input = document.getElementById(id);
            if (!input || !input.value.trim()) {
                markError(input);
                valid = false;
            }
        });
    }

    // üîπ –®–∞–≥ 2 ‚Äî –ü–æ—Å—ã–ª–∫–∞
    if (stepIndex === 2) {
        const weightsHidden = document.getElementById("weightsHidden");
        const weightInput = document.getElementById("parcelWeight");

        if (!weightsHidden || !weightsHidden.value.trim()) {
            markError(weightInput);
            valid = false;
        }

        ["parcelCity"].forEach(id => {
            const el = document.getElementById(id);
            if (!el || !el.value.trim()) {
                markError(el);
                valid = false;
            }
        });
    }

    // üîπ –®–∞–≥ 3 ‚Äî –û–ø–∏—Å—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    if (stepIndex === 3) {
        const container = document.getElementById("inventoryContainer");

        if (!container || container.children.length === 0) {
            markError(container);
            valid = false;
        }
    }

    // ‚ùå –®–ê–ì 4 ‚Äî –ë–ï–ó –ü–†–û–í–ï–†–ö–ò

    return valid;
}

/* =========================
   UI –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
========================= */

function updateUI() {
    steps.forEach((s, i) => {
        s.classList.toggle('active', i === currentStep);
        s.classList.toggle('completed', i < currentStep);
    });

    contents.forEach((c, i) => {
        c.classList.toggle('active', i === currentStep);
    });

    prevBtn.disabled = currentStep === 0;
    nextBtn.classList.toggle('hidden', currentStep === 4);
    finishBtn.classList.toggle('hidden', currentStep !== 4);
}

/* =========================
   –ö–Ω–æ–ø–∫–∏
========================= */

nextBtn.onclick = () => {
    if (!validateStep(currentStep)) return;

    if (currentStep < contents.length - 1) {
        currentStep++;
        updateUI();
        window.initInventoryWeightLabel(); // –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –≤–µ—Å —Å—Ä–∞–∑—É
    }
};

prevBtn.onclick = () => {
    if (currentStep > 0) {
        currentStep--;
        updateUI();
    }
};

/* =========================
   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
========================= */

updateUI();
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const sharedRecipientCheckbox = document.getElementById("sharedRecipient");
    const paymentBlock = document.getElementById("paymentBlock");

    if (!sharedRecipientCheckbox || !paymentBlock) return;

    window.togglePaymentBlock = function () {
        if (sharedRecipientCheckbox.checked) {
            paymentBlock.style.display = "none";

            // üîπ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
            const amount = document.getElementById("paymentAmount");
            if (amount) amount.value = "";

            document.querySelectorAll('input[name="payment"]').forEach(r => r.checked = false);
            document.querySelectorAll('input[name="currency"]').forEach(r => r.checked = false);
        } else {
            paymentBlock.style.display = "";
        }
    };

    // üîÅ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∫–ª–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    sharedRecipientCheckbox.addEventListener("change", togglePaymentBlock);

    // üîÅ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    togglePaymentBlock();
});
</script>




<script src="/static/js/shipments/inventory_input.js"></script>
<script src="/static/js/shipments/parcel-weight.js"></script>
<script src="/static/js/shipments/id_selector.js"></script>
<script src="/static/js/shipments/select-all.js"></script>
<script src="/static/js/shipments/selected_tot_w_c.js"></script>
<!-- —Å–∫–∞—á–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
<script src="/static/js/shipments/downloadManifest.js"></script>
<script src="/static/js/shipments/add_update_shipment.js"></script>
<script src="/static/js/shipments/input_validation.js"></script>



<!-- modal open close -->
<script>
function resetModalFields() {
    const modal = document.getElementById("parcelModal");
    if (!modal) return;

    modal.querySelectorAll("input, textarea, select").forEach(el => {
        if (!el) return;
        if (el.type === "radio" || el.type === "checkbox") {
            el.checked = false;
        } else {
            el.value = "";
        }
    });

    // inventory
    const inventoryInput = modal.querySelector("#inventoryInput");
    const inventoryContainer = modal.querySelector("#inventoryContainer");
    const autocompleteList = modal.querySelector("#autocompleteList");

    if (inventoryInput) inventoryInput.value = "";
    if (inventoryContainer) inventoryContainer.innerHTML = "";
    if (autocompleteList) autocompleteList.innerHTML = "";

    // –≤–µ—Å–∞
    const weightInput = modal.querySelector("#parcelWeight");
    const weightContainer = modal.querySelector("#weightContainer");
    const weightsHidden = modal.querySelector("#weightsHidden");

    if (weightInput) weightInput.value = "";
    if (weightContainer) weightContainer.innerHTML = "";
    if (weightsHidden) weightsHidden.value = "";
}
</script>









<!-- –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è -->

<script>
function resetModalExceptSender() {
    const modal = document.getElementById("parcelModal");

    // –≤—Å–µ –∏–Ω–ø—É—Ç—ã, –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    const inputs = modal.querySelectorAll(
        "input, textarea, select"
    );

    inputs.forEach(input => {
        if (
            input.id === "senderName" ||
            input.id === "senderSurname" ||
            input.id === "senderPhone"
        ) {
            return; // ‚ùó –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
        }

        if (input.type === "checkbox" || input.type === "radio") {
            input.checked = false;
        } else {
            input.value = "";
        }
    });

    // –æ—á–∏—â–∞–µ–º –æ–ø–∏—Å—å
    const inventoryContainer = modal.querySelector("#inventoryContainer");
    const autocompleteList = modal.querySelector("#autocompleteList");
    if (inventoryContainer) inventoryContainer.innerHTML = "";
    if (autocompleteList) autocompleteList.innerHTML = "";

    // –æ—á–∏—â–∞–µ–º –≤–µ—Å–∞
    const weightContainer = modal.querySelector("#weightContainer");
    const weightsHidden = modal.querySelector("#weightsHidden");
    if (weightContainer) weightContainer.innerHTML = "";
    if (weightsHidden) weightsHidden.value = "";
}
</script>


<script>
    function showToast(message, type = "success") {
    const container = document.getElementById("toast-container");

    const toast = document.createElement("div");
    toast.className = `shipment-toast ${type}`;
    toast.textContent = message;

    container.appendChild(toast);

    // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>

</body>
</html>


{% endblock %}
