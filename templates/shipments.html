<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/shipments.css') }}">s
</head>
<meta charset="UTF-8">
<title>–°–ø–∏—Å–æ–∫ –ø–æ—Å—ã–ª–æ–∫</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body>


<!--  –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç–∞—Ä–Ω–∏—Ü–µ -->
<div class="page-actions">
    <div class="action-card add" id="addParcelCard">
        <div class="icon">‚ûï</div>
        <div class="text">
            <div class="title">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</div>
            <div class="desc">–ù–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</div>
        </div>
    </div>

    <div class="action-card export">
        <div class="icon">‚¨áÔ∏è</div>
        <div class="text">
            <div class="title">–í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
            <div class="desc">Excel / PDF</div>
        </div>
    </div>

    <div class="action-card stats">
        <div class="icon">üìä</div>
        <div class="text">
            <div class="title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="desc">–î–æ—Ö–æ–¥—ã –∏ –ø–æ—Å—ã–ª–∫–∏</div>
        </div>
    </div>
</div>



<!--  –≥–ª–∞–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç–∞—Ä–Ω–∏—Ü–µ -->
<div class="shipments">

{% for shipment in shipments %}
<div class="parcel-card 
    {% if shipment.payment_status == 'paid' %}
        payment-paid
    {% else %}
        payment-unpaid
    {% endif %}
">

    <div class="parcel-main">

        <!-- ‚Ññ –ø–æ—Å—ã–ª–∫–∏ -->
        <div>
            <div class="label">‚Ññ –ø–æ—Å—ã–ª–∫–∏</div>
            <div class="value">
                TRK-{{ shipment.shipment_number or shipment.id }}
            </div>
            <div class="label">{{ shipment.order_date.strftime('%d.%m.%Y %H:%M') if shipment.order_date else '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</div>
        </div>

        <!-- –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å -->
        <div>
            <div class="label">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</div>
            <div class="value">
                {{ shipment.sender_name }} {{ shipment.sender_surname }}
            </div>
            <div class="phone">
                {{ shipment.sender_number }}
            </div>
        </div>

        <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å -->
        <div>
            <div class="label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</div>
            <div class="receiver-name">
                <div class="value">
                    {{ shipment.recipient_name }} {{ shipment.recipient_surname }}
                </div>
                <button class="copy-btn" onclick="copyName(this)">üìã</button>
            </div>
            <div class="phone">
                {{ shipment.recipient_number }}
            </div>
        </div>

        <!-- –ö–æ–ª-–≤–æ / –≤–µ—Å -->
        <div>
            <div class="label">–ö–æ–ª-–≤–æ / –≤–µ—Å</div>
            <div class="value">
                {{ shipment.parcels_count }} —à—Ç
            </div>
        </div>

        <!-- –ì–æ—Ä–æ–¥ -->
        <div>
            <div class="label">–ì–æ—Ä–æ–¥</div>
            <div class="value">
                {{ shipment.city_to }}
            </div>
        </div>

        <button class="toggle-btn">‚åÑ</button>
    </div>

    <!-- üîΩ –î–µ—Ç–∞–ª–∏ -->
    <div class="parcel-details">
        <div><b>–û–ø–∏—Å—å:</b> {{ shipment.description }}</div>

        <div>
            <b>–û–ø–ª–∞—Ç–∞:</b>
            {% if shipment.payment_status == 'paid' %}
                –û–ø–ª–∞—á–µ–Ω–æ
            {% else %}
                –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ
            {% endif %}
        </div>
        <div>
            <b>–í–µ—Å–∞</b>
            {{ shipment.weights }}
        </div>
        <div>
            <b>–°—Ç–æ–∏–º–æ—Å—Ç—å –≥—Ä—É–∑–∞:</b>
            {{ shipment.cargo_cost }} {{ shipment.currency }}
        </div>

        <div><b>–ü–∞—Å–ø–æ—Ä—Ç:</b> {{ shipment.recipient_passport }}</div>

        <div><b>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</b> {{ shipment.address }}</div>

        <div>
            <b>–î–∞—Ç–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:</b>
            {{ shipment.order_date.strftime('%d.%m.%Y %H:%M') if shipment.order_date }}
        </div>
    </div>

</div>
{% else %}
    <div class="empty-state">
        –ü–æ—Å—ã–ª–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
    </div>
{% endfor %}

</div>


</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div class="modal-overlay" id="parcelModal">
    <div class="modal">

        <!-- –®–∞–≥–∏ -->
        <div class="modal-steps">
            <div class="steps">

                <div class="step active" data-step="0">
                    <div class="circle">üë§</div>
                    <div class="label">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</div>
                </div>

                <div class="step" data-step="1">
                    <div class="circle">üì¶</div>
                    <div class="label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</div>
                </div>

                <div class="step" data-step="2">
                    <div class="circle">‚öñÔ∏è</div>
                    <div class="label">–ü–æ—Å—ã–ª–∫–∞</div>
                </div>

                <div class="step" data-step="3">
                    <div class="circle">üìù</div>
                    <div class="label">–û–ø–∏—Å—å</div>
                </div>

                <div class="step" data-step="4">
                    <div class="circle">üìù</div>
                    <div class="label">–û–ø–ª–∞—Ç–∞</div>
                </div>

            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="modal-content">

            <div class="step-content active">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ</h3>
                <div class="sender-form">

                    <div class="input-group">
                        <label>–ò–º—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" id="senderName">
                    </div>

                    <div class="input-group">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" id="senderSurname">
                    </div>

                    <div class="input-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" placeholder="+995 5XX XXX XXX" id="senderPhone">
                    </div>

                </div>
                
            </div>

            <div class="step-content">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ</h3>
                <div class="recipient-form">

                    <div class="input-group">
                        <label>–ò–º—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" id="recipientName">
                    </div>

                    <div class="input-group">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" id="recipientSurname">
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" placeholder="+995 5XX XXX XXX" id="recipientPhone">
                        </div>

                        <div class="input-group">
                            <label>–ü–∞—Å–ø–æ—Ä—Ç</label>
                            <input type="text" placeholder="* * * * *" id="recipientPassport">
                        </div>
                    </div>

                </div>
            </div>

            <div class="step-content">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å—ã–ª–∫–µ</h3>
                <div class="parcel-form">

                    <div class="input-row">
                        <div class="input-group">
                            <label>–í–µ—Å</label>
                            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏–ª–∏ –≤–µ—Å–∞" id="parcelWeight">
                            <input type="hidden" name="weights" id="weightsHidden">
                        </div>
                        <!-- –ì–æ—Ä–æ–¥ (—Å–ø–∏—Å–æ–∫) -->
                        <div class="input-group">
                            <label>–ì–æ—Ä–æ–¥ –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                            <select id="parcelCity">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                <option>–¢–±–∏–ª–∏—Å–∏</option>
                                <option>–ë–∞—Ç—É–º–∏</option>
                                <option>–ö—É—Ç–∞–∏—Å–∏</option>
                                <option>–ú–æ—Å–∫–≤–∞</option>
                            </select>
                        </div>
                    </div>
                    <div id="weightContainer" class="weight-container"></div>
                    

                    <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∫ –æ–ø–ª–∞—Ç–µ -->
                    <div class="row">
                        <div class="input-group">
                            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –≥—Ä—É–∑–∞</label>
                            <input type="number" placeholder="0.00" id="parcelCost">
                        </div>
                    </div>

                    <!-- –ê–¥—Ä–µ—Å -->
                    <div class="input-group">
                        <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <input type="text" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞" id="parcelAddress">
                    </div>
                </div>
            </div>

            <div class="step-content">
                <h3>–û–ø–∏—Å—å</h3>
                <!-- –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ -->
            <div class="modern-textarea-wrapper">
                <div id="inventoryContainer" class="inventory-container"></div>
                <input 
                    id="inventoryInput" 
                    type="text" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..." 
                    autocomplete="off"
                    data-inventory='{{ inventory|tojson }}'>
                <ul id="autocompleteList" class="autocomplete-list"></ul>
            </div>
            </div>

            <div class="step-content">
                <h3>–û–ø–ª–∞—Ç–∞</h3>
                <div class="parcel-form">
                    <div class="input-group">
                        <label>–ö –æ–ø–ª–∞—Ç–µ</label>
                        <input type="number" placeholder="0.00" id="paymentAmount">
                    </div>
                    <div class="radio-group">
                        <span class="group-title">–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã</span>
                        <label class="radio">
                            <input type="radio" name="payment" id="paid">
                            <span>–û–ø–ª–∞—á–µ–Ω–æ</span>
                        </label>

                        <label class="radio">
                            <input type="radio" name="payment" id="unpaid">
                            <span>–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>
                        </label>

                        <label class="radio">
                            <input type="radio" name="payment" id="card">
                            <span>–° –∫–∞—Ä—Ç—ã</span>
                        </label>
                    </div>

                    <div class="radio-group">
                        <span class="group-title">–í–∞–ª—é—Ç–∞</span>

                        <label class="radio"><input type="radio" name="currency" id="GEL"><span>GEL</span></label>
                        <label class="radio"><input type="radio" name="currency" id="RUB"><span>RUB</span></label>
                        <label class="radio"><input type="radio" name="currency" id="EUR"><span>EUR</span></label>
                        <label class="radio"><input type="radio" name="currency" id="USD"><span>USD</span></label>
                    </div>

                    <div class="checkbox-group">
                        <label class="checkbox">
                            <input type="checkbox" id="sharedRecipient">
                            <span>–ü–æ–ª—É—á–∞—Ç–µ–ª—å –æ–±—â–∏–π —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ—Å—ã–ª–∫–æ–π</span>
                        </label>
                    </div>
                </div>

            </div>


        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="modal-actions">
            <button id="prevBtn" disabled>–ù–∞–∑–∞–¥</button>
            <button id="closeModalBtn" style="background-color: rgb(255, 97, 97)">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button id="nextBtn">–î–∞–ª–µ–µ</button>
            <button id="finishBtn" class="hidden">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>

    </div>
</div>



<script>
document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const card = btn.closest('.parcel-card');
        const details = card.querySelector('.parcel-details');

        const open = details.style.display === 'block';
        details.style.display = open ? 'none' : 'block';
        btn.style.transform = open ? 'rotate(0)' : 'rotate(180deg)';
    });
});

function copyName(btn) {
    const name = btn.parentElement.querySelector('.value').innerText;
    navigator.clipboard.writeText(name);

    btn.innerText = '‚úì';
    setTimeout(() => btn.innerText = 'üìã', 1000);
}
</script>







<script>
let currentStep = 0;

const steps = document.querySelectorAll('.step');
const contents = document.querySelectorAll('.step-content');

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const finishBtn = document.getElementById('finishBtn');

function updateUI() {
    steps.forEach((s, i) => {
        s.classList.toggle('active', i === currentStep);
        s.classList.toggle('completed', i < currentStep);
    });

    contents.forEach((c, i) => {
        c.classList.toggle('active', i === currentStep);
    });

    prevBtn.disabled = currentStep === 0;
    nextBtn.classList.toggle('hidden', currentStep === 4);
    finishBtn.classList.toggle('hidden', currentStep !== 4);
}

nextBtn.onclick = () => {
    if (currentStep < 4) {
        currentStep++;
        updateUI();
    }
};

prevBtn.onclick = () => {
    if (currentStep > 0) {
        currentStep--;
        updateUI();
    }
};

updateUI();
</script>



<script src="/static/js/shipments/inventory_input.js"></script>
<script src="/static/js/shipments/parcel-weight.js"></script>
<!-- modal open close -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const addCard = document.getElementById("addParcelCard");
        const modal = document.getElementById("parcelModal");
        const closeBtn = document.getElementById("closeModalBtn");

        // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
        function resetModalFields() {
            const forms = modal.querySelectorAll("form"); // –≤—Å–µ —Ñ–æ—Ä–º—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
            forms.forEach(form => form.reset());

            // –æ—á–∏—â–∞–µ–º –æ–±—ã—á–Ω—ã–µ –∏–Ω–ø—É—Ç—ã, textarea, select
            const inputs = modal.querySelectorAll("input, textarea, select");
            inputs.forEach(input => {
                if (input.type === "checkbox" || input.type === "radio") {
                    input.checked = false;
                } else if (input.tagName.toLowerCase() === "textarea") {
                    input.value = "";
                } else {
                    input.value = "";
                }
            });

            // —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–ª—è inventory –ø–æ–ª—è —Å —Ç–µ–≥–∞–º–∏
            const inventoryInput = modal.querySelector("#inventoryInput");
            const inventoryContainer = modal.querySelector("#inventoryContainer");
            const autocompleteList = modal.querySelector("#autocompleteList");

            if (inventoryInput) inventoryInput.value = "";
            if (inventoryContainer) inventoryContainer.innerHTML = ""; // –æ—á–∏—â–∞–µ–º –≤—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏
            if (autocompleteList) autocompleteList.innerHTML = "";     // –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞

            // ‚úÖ –í–ï–°–ê
            const weightInput = modal.querySelector("#parcelWeight");
            const weightContainer = modal.querySelector("#weightContainer");
            const weightsHidden = modal.querySelector("#weightsHidden");

            if (weightInput) weightInput.value = "";
            if (weightContainer) weightContainer.innerHTML = "";
            if (weightsHidden) weightsHidden.value = "";
        }

        // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        addCard.addEventListener("click", () => {
            modal.style.display = "flex";
        });

        // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        closeBtn.addEventListener("click", () => {
            modal.style.display = "none";
            resetModalFields();
        });

        // –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–∫–æ–º –ø–æ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—é
        modal.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.style.display = "none";
                resetModalFields();
            }
        });
    });

</script>


<script>
    document.getElementById("finishBtn").addEventListener("click", () => {
        const data = {
            senderName: document.getElementById("senderName").value,
            senderSurname: document.getElementById("senderSurname").value,
            senderPhone: document.getElementById("senderPhone").value,

            recipientName: document.getElementById("recipientName").value,
            recipientSurname: document.getElementById("recipientSurname").value,
            recipientPhone: document.getElementById("recipientPhone").value,
            recipientPassport: document.getElementById("recipientPassport").value,

            weightsHidden: document.getElementById("weightsHidden").value,
            parcelCity: document.getElementById("parcelCity").value,
            parcelCost: document.getElementById("parcelCost").value,
            parcelAddress: document.getElementById("parcelAddress").value,

            inventory: Array.from(document.getElementById("inventoryContainer").children).map(e => e.textContent.trim()),

            paymentAmount: document.getElementById("paymentAmount").value,
            paymentStatus: document.querySelector('input[name="paymentStatus"]:checked')?.value || "",
            currency: document.querySelector('input[name="currency"]:checked')?.value || "",
            sharedRecipient: document.getElementById("sharedRecipient").checked
        };

        fetch("/shipment_submit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç:", result);
            // –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –∏ –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è
        })
        .catch(err => console.error("–û—à–∏–±–∫–∞:", err));
    });

</script>
</body>
</html>
